<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="/assets/style.css">
    <title>Document</title>
  </head>
  <body>
    <section class="container">
      
  <nav>
    <h2>Android v3</h2>
    
    <ul class="sidebar-nav"><li class="bold"><a href="/android/v3/guides/">Guides</a><ul><li><a href="/android/v3/tutorials/locationdatasourcespeoplelocationdatasource/">Creating your own Location Data Source - Part 1</a></li>
<li><a href="/android/v3/tutorials/locationdatasourcesbatterieslocationdatasource/">Creating your own Location Data Source - Part 2</a></li>
<li><a href="/android/v3/tutorials/locationdatasourceslocationdatasourcesfragment/">Creating your own Location Data Source - Part 3</a></li>
<li><a href="/android/v3/tutorials/locationclusteringlocationclusteringfragment/">Work with location grouping / clustering</a></li>
<li><a href="/android/v3/tutorials/locationdetailsdemolocationdetailsfragment/">Show Location Details</a></li>
<li><a href="/android/v3/tutorials/searchmapdemosearchfragment/">Create a Search Experience with MapsIndoors - Part 1</a></li>
<li><a href="/android/v3/tutorials/searchmapdemosearchmapfragment/">Create a Search Experience with MapsIndoors - Part 2</a></li>
<li class="active"><a href="/android/v3/tutorials/showuserlocationdemopositionprovider/">Show the Blue Dot with MapsIndoors - Part 1</a></li>
<li><a href="/android/v3/tutorials/showuserlocationshowuserlocationfragment/">Show the Blue Dot with MapsIndoors - Part 2</a></li></ul></li>
<li><a href="/android/v3/changelog/">Changelog</a></li></ul>
  </nav>

      <main>
        <p>In this tutorial we will show how you can show a blue dot on the map, representing the user's location. The position will be served from a mocked positioning provider and displayed on a map in a view controller.</p>
<p>We will start by creating our implementation of a positioning provider.</p>
<p>Create the class <code>DemoPositionProvider</code> that implements <code>PositionProvider</code>:</p>
<pre><code class="language-java">public class DemoPositionProvider implements PositionProvider
</code></pre>
<p>Add some member variables to <code>DemoPositionProvider</code>:</p>
<ul>
<li><code>mPositionUpdateListener</code>: The listener object</li>
<li><code>isRunning</code>: A running state boolean flag</li>
<li><code>mLatestPosition</code>: The latest positioning result</li>
<li><code>mPositionUpdateTimer</code>: A timer so we can update the position of the user within an time interval</li>
</ul>
<pre><code class="language-java">OnPositionUpdateListener mPositionUpdateListener;
boolean isRunning = false;
MPPositionResult mLatestPosition;
MPPositionResult fixedPosition =  new MPPositionResult(
        new Point( 57.05813067, 9.95058065  ),
        0,
        0
);
Timer mPositionUpdateTimer = new Timer();
</code></pre>
<p>Create a method called <code>updatePosition</code>. This will be our &quot;loop&quot; constantly posting a new position to the delegate:</p>
<ul>
<li>Check if the provider has a running state</li>
<li>Assign the <code>fixedPosition</code> value to <code>mLatestPosition</code></li>
<li>Notify the listener by calling <code>onPositionUpdate</code> passing the new position as argument</li>
</ul>
<pre><code class="language-java">void updatePosition(){
    if(isRunning){
        mLatestPosition = fixedPosition;
        mLatestPosition.setProvider( this );
        if (mPositionUpdateListener != null) {
            mPositionUpdateListener.onPositionUpdate(mLatestPosition);
        }
    }
}
</code></pre>
<p>Implement the <code>isPSEnabled</code> method to check is the Positioning system is working or not, in this case the PS is always working since it's a mocked positioning provider.</p>
<pre><code class="language-java">@Override
public boolean isPSEnabled() {
    return true ;
}
</code></pre>
<p>Implement the <code>startPositioning</code> method. We set the <code>running</code> boolean to true and schedule the repeating task of updating the user position by calling the updatePosition every 3 seconds:</p>
<pre><code class="language-java">@Override
public void startPositioning(@Nullable String arg) {
    isRunning = true;
    // Set the schedule function and rate
    mPositionUpdateTimer.scheduleAtFixedRate( new TimerTask() {
        @Override
        public void run() {
            updatePosition();
        }
    }, 0, 3000 );
}
</code></pre>
<p>Implement the <code>stopPositioning</code> method. We set the <code>running</code> boolean to false and stop the timer:</p>
<pre><code class="language-java">@Override
public void stopPositioning(@Nullable String arg) {
    isRunning = false;
    mPositionUpdateTimer.cancel();
}
</code></pre>
<p>Implement the <code>isRunning</code> method. Return the value of <code>isRunning</code>:</p>
<pre><code class="language-java">@Override
public boolean isRunning() {
    return isRunning ;
}
</code></pre>
<p>In <a href="../showuserlocationshowuserlocationfragment">Part 2</a> we will create the map fragment that displays the blue dot.</p>
<p><a href="https://github.com/MapsIndoors/MapsIndoorsAndroid-Demo-Samples/blob/master/app/src/main/java/com/mapsindoors/showuserLocation/DemoPositionProvider.java">See the sample in DemoPositionProvider.java</a></p>

      </main>
    </section>
  </body>
</html>
