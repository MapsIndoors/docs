<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="/assets/style.css">
    <title>Document</title>
  </head>
  <body>
    <section class="container">
      
  <nav>
    <h2>Android v2</h2>
    
    <ul class="sidebar-nav"><li class="active bold"><a href="/android/v2/guides/">Guides</a><ul><li><a href="/android/v2/tutorials/locationdetailsdemolocationdetailsfragment/">Show Location Details</a></li>
<li><a href="/android/v2/tutorials/searchmapdemosearchfragment/">Create a Search Experience with MapsIndoors - Part 1</a></li>
<li><a href="/android/v2/tutorials/searchmapdemosearchmapfragment/">Create a Search Experience with MapsIndoors - Part 2</a></li>
<li><a href="/android/v2/tutorials/showuserlocationdemopositionprovider/">Show the Blue Dot with MapsIndoors - Part 1</a></li>
<li><a href="/android/v2/tutorials/showuserlocationshowuserlocationfragment/">Show the Blue Dot with MapsIndoors - Part 2</a></li></ul></li>
<li><a href="/android/v2/changelog/">Changelog</a></li></ul>
  </nav>


      <main>
        <blockquote>
<p>A <a href="https://www.markdownguide.org/android/v3">newer version</a> of the MapsIndoors SDK for Android is available. The legacy version will not receive new features and will only get critical bugfix and security updates.
{: .mi-warning}</p>
</blockquote>
<h2>Searching for Locations and Displaying the Results on a Map</h2>
<p>Use the <code>MPLocationsProvider</code> class to search for content in your MapsIndoors solution.</p>
<p>This example shows how to setup a query for the nearest single best matching location and display the result on the map:</p>
<pre><code class="language-java">mLocationsProvider = new MPLocationsProvider();

mLocationQueryBuilder =     new LocationQuery.Builder();

// init the query builder, in this case we will query the coffee machine in our office
mLocationQueryBuilder.
        setQuery(&quot;coffee machine&quot;).
        setOrderBy( LocationQuery.NO_ORDER ).
        setFloor(1).
        setMaxResults(1);
// Build the query
mLocationQuery = mLocationQueryBuilder.build();
// Query the data
mLocationsProvider.getLocationsAsync( mLocationQuery, new OnLocationsReadyListener()
{
    @Override
    public void onLocationsReady( @Nullable List&lt; Location &gt; locations, @Nullable MIError error )
    {
        if( locations != null &amp;&amp; locations.size() != 0 )
        {
            mMapControl.displaySearchResults( Collections.singletonList( locations.get( 0 ) ), true );
        }
    }
});
</code></pre>
<p>This example shows how to setup a query for a group of locations and display the result on the map:</p>
<pre><code class="language-java">mLocationsProvider = new MPLocationsProvider();

mLocationQueryBuilder =     new LocationQuery.Builder();

// init the query builder, in this case we will query the coffee machine in our office
mLocationQueryBuilder.
        setQuery(&quot;Toilet&quot;).
        setOrderBy( LocationQuery.NO_ORDER ).
        setFloor(1).
        setMaxResults(50);
// Build the query
mLocationQuery = mLocationQueryBuilder.build();
// Query the data
mLocationsProvider.getLocationsAsync( mLocationQuery, new OnLocationsReadyListener()
{
    @Override
    public void onLocationsReady( @Nullable List&lt; Location &gt; locations, @Nullable MIError error )
    {
        if( locations != null &amp;&amp; locations.size() != 0 )
        {
            mMapControl.displaySearchResults( locations, true );
        }
    }
});
</code></pre>
<p>Please note that you are not guaranteed that the visible floor contains any search results, so that is why we change floor in the above example.</p>
<h2>Getting a Polygon from a Location</h2>
<p>Some locations in MapsIndoors can have additional polygon information. These polygons can be used to render a room or area in a special way or make geofences, calculating whether another point or location is contained within the polygon. If a <code>MPLocation</code> has polygons, these can be retrieved using:</p>
<pre><code class="language-java">Geometry geometry = location.getGeometry();
switch( geometry.getIType() ) {
    case Geometry.TYPE_POINT: {
        Point point = (Point) geometry;
        break;
    }
    case Geometry.TYPE_POLYGON: {
        PolygonGeometry polygon = (PolygonGeometry) geometry;

        // Using GMS helper classes
        // Get all the paths in the polygon
        final List&lt;List&lt;LatLng&gt;&gt; paths = polygon.getGMSPath();

        final int pathCount = paths.size();

        // Outer ring (first)
        List&lt;LatLng&gt; path = paths.get( 0 );
        for( final LatLng coordinate : path ) {
            double lat = coordinate.latitude;
            double lng = coordinate.longitude;
        }

        // Optional: Inner rings (holes)
        for( int i = 1; i &lt; pathCount; i++ ) {
            List&lt;LatLng&gt; hole = paths.get( i );
            for( final LatLng coordinate : hole ) {
                double lat = coordinate.latitude;
                double lng = coordinate.longitude;
            }
        }
        break;
    }
}
</code></pre>
<p>As demonstrated above, a polygon's outer ring/path as well as holes are arranged as [longitude, latitude] pairs. As not all locations has polygons, the polygon array may be empty. On the contrary, some locations, like entire building floors, might have more than polygon.</p>

      </main>
    </section>
  </body>
</html>
