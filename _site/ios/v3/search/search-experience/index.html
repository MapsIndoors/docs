<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="/assets/style.css">
    <title>Document</title>
  </head>
  <body>
    <section class="container">
      
  <nav>
    <h2>iOS v3</h2>
    
    <ul class="sidebar-nav"><li><a href="/ios/v3/getting-started/">Getting started</a></li>
<li class="bold"><a href="/ios/v3/mapsindoors/">MapsIndoors</a><ul><li><a href="/ios/v3/mapsindoors/handling-marker-selections/">Handling marker selections and other user events</a></li>
<li><a href="/ios/v3/mapsindoors/getting-marker-from-location/">Getting a marker from a location and vice versa</a></li>
<li><a href="/ios/v3/mapsindoors/getting-polygon-from-location/">Getting a polygon from a location</a></li>
<li><a href="/ios/v3/mapsindoors/blue-dot/">Show the user's location aka. Blue Dot</a></li>
<li><a href="/ios/v3/mapsindoors/create-custom-ui/">Create custom UI</a></li></ul></li>
<li class="bold"><a href="/ios/v3/locations/">Locations</a><ul><li><a href="/ios/v3/locations/get-details-for-selected-location/">Show details for selected Location</a></li>
<li><a href="/ios/v3/locations/working-grouping/">Working with Location Grouping (Clustering)</a></li>
<li><a href="/ios/v3/locations/creating-own-location-sources/">Creating your own Location Sources</a></li></ul></li>
<li class="bold"><a href="/ios/v3/directions/">Directions</a><ul><li><a href="/ios/v3/directions/directions-wayfinding-instructions/">Get Directions and Show Wayfinding Instructions</a></li>
<li><a href="/ios/v3/directions/display-route-on-map/">Display Route on map</a></li>
<li><a href="/ios/v3/directions/directions-result-map/">Get Directions and Show the Result on a Map</a></li>
<li><a href="/ios/v3/directions/working-with-directions-settings/">Subscribe to floor changes in the rendering</a></li>
<li><a href="/ios/v3/directions/working-with-events/">Working with Events</a></li>
<li><a href="/ios/v3/directions/subscribe-to-floor-changes/">Subscribe to floor changes in the rendering</a></li></ul></li>
<li class="bold"><a href="/ios/v3/map-styling/">Map Styling</a><ul><li><a href="/ios/v3/map-styling/work-with-display-settings/">Working with Display Settings</a></li></ul></li>
<li class="bold"><a href="/ios/v3/search/">Search</a><ul><li class="active"><a href="/ios/v3/search/search-experience/">Create a search experience with MapsIndoors</a></li>
<li><a href="/ios/v3/search/filter-locations-on-map-by-search-query/">Filter Locations on map by search query</a></li></ul></li>
<li><a href="/ios/v3/offline/">Download and bundle offline content</a></li>
<li><a href="/ios/v3/changelog/">Changelog</a></li></ul>
  </nav>

      <main>
        <p>This is an example of creating a simple search experience using MapsIndoors. We will create a map with a search button that leads to another view controller that handles the search and selection. On selection of a location, we go back to the map and shows the selected location on the map.</p>
<p>We will start by creating a simple search controller that handles search and selection of MapsIndoors locations</p>
<p>Declare a protocol for our location selection with a <code>didSelectLocation</code> method</p>
<pre><code class="language-swift">protocol MySearchControllerDelegate {
    func didSelectLocation(location:MPLocation)
}
</code></pre>
<p>Define <code>MySearchController</code>. In this tutorial our search controller is a <code>UIViewController</code> that implements the protocols <code>UISearchBarDelegate</code>, <code>UITableViewDelegate</code> and <code>UITableViewDataSource</code></p>
<pre><code class="language-swift">class MySearchController: UIViewController, UISearchBarDelegate, UITableViewDelegate, UITableViewDataSource {
</code></pre>
<p>Setup member variables for <code>MySearchController</code>:</p>
<ul>
<li>An instance of type <code>MPLocationService</code></li>
<li>An instance of type <code>MPQuery</code></li>
<li>An array of <code>MPLocation</code> to hold your list of results</li>
<li>Your delegate object</li>
<li>A search bar view</li>
<li>A table view</li>
</ul>
<pre><code class="language-swift">let locationService = MPLocationService.sharedInstance()
let query = MPQuery.init()
var locations:[MPLocation] = []
var delegate:MySearchControllerDelegate? = nil
let tableView = UITableView.init()
let searchBar = UISearchBar.init()
</code></pre>
<p>In <code>viewDidLoad</code>, wire up your view controller to the tableview and search bar.</p>
<pre><code class="language-swift">searchBar.delegate = self
tableView.delegate = self
tableView.dataSource = self
</code></pre>
<p>Register a class for the reusable table view cell.</p>
<pre><code class="language-swift">tableView.register(UITableViewCell.self, forCellReuseIdentifier: &quot;reuseIdentifier&quot;)
</code></pre>
<p>Arrange the search bar and the table view in a stack view.</p>
<pre><code class="language-swift">let topFiller = UIView.init()
let stackView = UIStackView.init(arrangedSubviews: [topFiller, searchBar, tableView])
stackView.axis = .vertical
view = stackView
let kw = UIApplication.shared.keyWindow
topFiller.heightAnchor.constraint(equalToConstant:kw?.safeAreaInsets.top ?? 0).isActive = true
topFiller.backgroundColor = .blue
searchBar.barTintColor = .blue
searchBar.tintColor = .white
searchBar.showsCancelButton = true
searchBar.becomeFirstResponder()
</code></pre>
<p>In <code>MySearchController</code>, implement the <code>numberOfSections</code> method, return 1.</p>
<pre><code class="language-swift">func numberOfSections(in tableView: UITableView) -&gt; Int {
    return 1
}
</code></pre>
<p>Implement the <code>numberOfRowsInSection</code> method, return the length of your locations array.</p>
<pre><code class="language-swift">func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int {
    return locations.count
}
</code></pre>
<p>Implement the <code>textDidChange</code> method:</p>
<ul>
<li>Change the query objects query property to reflect the current search text</li>
<li>Call <code>getLocationsUsing</code> with the modified query</li>
<li>In the callback block, reset the locations array with new results</li>
<li>Reload table view</li>
</ul>
<pre><code class="language-swift">func searchBar(_ searchBar: UISearchBar, textDidChange searchText: String) {
    if searchText.count &gt; 0 {
        query.query = searchText
        let filter = MPFilter()
        filter.take = 10
        locationService.getLocationsUsing(query, filter: filter) { (locations, error) in
            if error == nil {
                self.locations = locations!
                self.tableView.reloadData()
            }
        }
    } else {
        self.locations = []
        self.tableView.reloadData()
    }
}
</code></pre>
<p>Implement the <code>searchBarCancelButtonClicked</code> method, with dismissal of the view controller.</p>
<pre><code class="language-swift">func searchBarCancelButtonClicked(_ searchBar: UISearchBar) {
    self.dismiss(animated: true, completion: nil)
}
</code></pre>
<p>Implement the <code>tableView:cellForRowAt</code> method. Set the <code>cell.textLabel.text</code> to reflect the <em>name</em> of the location of same index.</p>
<pre><code class="language-swift">func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell {
    let cell = tableView.dequeueReusableCell(withIdentifier: &quot;reuseIdentifier&quot;, for: indexPath)
    cell.textLabel?.text = locations[indexPath.row].name
    let defaultValue = &quot;&quot;
    cell.textLabel?.text?.append(&quot;, \(locations[indexPath.row].roomId ?? defaultValue), \(locations[indexPath.row].building ?? defaultValue), \(locations[indexPath.row].venue ?? defaultValue)&quot;)
    return cell
}
</code></pre>
<p>Implement the <code>tableView:didSelectRowAt</code> method. In this example we just call the delegate method and dismiss the view controller.</p>
<p>Delegate method will be handled by SearchMapController.</p>
<pre><code class="language-swift">func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) {
    delegate?.didSelectLocation(location: locations[indexPath.row])
    self.dismiss(animated: true, completion: nil)
}
</code></pre>
<p><a href="https://github.com/MapsIndoors/MapsIndoorsIOS/blob/master/Example/DemoSamples/Search/MySearchController.swift">See the sample in MySearchController.swift</a></p>

      </main>
    </section>
  </body>
</html>
