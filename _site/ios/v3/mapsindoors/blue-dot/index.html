<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="/assets/style.css">
    <title>Document</title>
  </head>
  <body>
    <section class="container">
      
  <nav>
    <h2>iOS v3</h2>
    
    <ul class="sidebar-nav"><li><a href="/ios/v3/getting-started/">Getting started</a></li>
<li class="bold"><a href="/ios/v3/mapsindoors/">MapsIndoors</a><ul><li><a href="/ios/v3/mapsindoors/handling-marker-selections/">Handling marker selections and other user events</a></li>
<li><a href="/ios/v3/mapsindoors/getting-marker-from-location/">Getting a marker from a location and vice versa</a></li>
<li><a href="/ios/v3/mapsindoors/getting-polygon-from-location/">Getting a polygon from a location</a></li>
<li class="active"><a href="/ios/v3/mapsindoors/blue-dot/">Show the user's location aka. Blue Dot</a></li>
<li><a href="/ios/v3/mapsindoors/create-custom-ui/">Create custom UI</a></li></ul></li>
<li class="bold"><a href="/ios/v3/locations/">Locations</a><ul><li><a href="/ios/v3/locations/get-details-for-selected-location/">Show details for selected Location</a></li>
<li><a href="/ios/v3/locations/working-grouping/">Working with Location Grouping (Clustering)</a></li>
<li><a href="/ios/v3/locations/creating-own-location-sources/">Creating your own Location Sources</a></li></ul></li>
<li class="bold"><a href="/ios/v3/directions/">Directions</a><ul><li><a href="/ios/v3/directions/directions-wayfinding-instructions/">Get Directions and Show Wayfinding Instructions</a></li>
<li><a href="/ios/v3/directions/display-route-on-map/">Display Route on map</a></li>
<li><a href="/ios/v3/directions/directions-result-map/">Get Directions and Show the Result on a Map</a></li>
<li><a href="/ios/v3/directions/working-with-directions-settings/">Subscribe to floor changes in the rendering</a></li>
<li><a href="/ios/v3/directions/working-with-events/">Working with Events</a></li>
<li><a href="/ios/v3/directions/subscribe-to-floor-changes/">Subscribe to floor changes in the rendering</a></li></ul></li>
<li class="bold"><a href="/ios/v3/map-styling/">Map Styling</a><ul><li><a href="/ios/v3/map-styling/work-with-display-settings/">Working with Display Settings</a></li></ul></li>
<li class="bold"><a href="/ios/v3/search/">Search</a><ul><li><a href="/ios/v3/search/search-experience/">Create a search experience with MapsIndoors</a></li>
<li><a href="/ios/v3/search/filter-locations-on-map-by-search-query/">Filter Locations on map by search query</a></li></ul></li>
<li><a href="/ios/v3/offline/">Download and bundle offline content</a></li>
<li><a href="/ios/v3/changelog/">Changelog</a></li></ul>
  </nav>

      <main>
        <p>In this tutorial we will show how you can show a blue dot on the map, representing the users location. The position will be served from a mocked positioning provider and displayed on a map in a view controller.</p>
<p>We will start by creating our implementation of a positioning provider.</p>
<p>Create a class <code>MyPositionProvider</code> that inherits from NSObject and implements <code>MPPositionProvider</code>.</p>
<pre><code class="language-swift">class MyPositionProvider : NSObject, MPPositionProvider {
</code></pre>
<p>Add some member variables to <code>MyPositionProvider</code>.</p>
<ul>
<li><code>delegate</code>: The delegate object</li>
<li><code>running</code>: A running state boolean flag</li>
<li><code>latestPositionResult</code>: The latest positioning result</li>
<li><code>preferAlwaysLocationPermission</code>: A boolean that indicates whether this provider requires Apple Location Services to always be active</li>
<li><code>locationServicesActive</code>: A boolean that indicates whether Apple Location Services is currently active</li>
<li><code>providerType</code>: A provider type enum, convenient when working with multiple positioning providers in the same application</li>
</ul>
<pre><code class="language-swift">var delegate: MPPositionProviderDelegate?
private var running = false
var latestPositionResult: MPPositionResult?
var preferAlwaysLocationPermission: Bool = false
var locationServicesActive: Bool = false
var providerType: MPPositionProviderType = .GPS_POSITION_PROVIDER
var heading:Double = 0
</code></pre>
<p>Create a method called <code>updatePosition</code>. This will be our &quot;loop&quot; constantly posting a new position to the delegate.</p>
<ul>
<li>Check if the provider has a running state</li>
<li>Assign a new <code>MPPositionResult</code> to <code>latestPositionResult</code></li>
<li>Assign a new position point</li>
<li>Optionally specify that heading is available and set a heading</li>
<li>Notify the delegate by calling <code>onPositionUpdate</code> passing the new position as argument</li>
<li>Schedule a new delayed call of this method</li>
</ul>
<pre><code class="language-swift">private func updatePosition() {
    if running {
        latestPositionResult = MPPositionResult.init()
        latestPositionResult?.geometry = MPPoint.init(lat: 57.057964, lon: 9.9504112)
        latestPositionResult?.provider = self
        latestPositionResult?.headingAvailable = true
        heading = (heading + 10).truncatingRemainder(dividingBy: 360)
        latestPositionResult?.setHeadingDegrees(heading)

        if let delegate = self.delegate, let latestPositionResult = self.latestPositionResult {
            delegate.onPositionUpdate(latestPositionResult)
        }

        DispatchQueue.main.asyncAfter(deadline: .now() + 1) {
            self.updatePosition()
        }
    }
}
</code></pre>
<p>Implement the <code>requestLocationPermissions</code> method. In this example we will just set the <code>locationServicesActive</code> to true.</p>
<pre><code class="language-swift">func requestLocationPermissions() {
    locationServicesActive = true
}
</code></pre>
<p>Implement the <code>updateLocationPermissionStatus</code> method. In this example we will just set the <code>locationServicesActive</code> to true.</p>
<pre><code class="language-swift">func updateLocationPermissionStatus() {
    locationServicesActive = true
}
</code></pre>
<p>Implement the <code>startPositioning</code> method. We set the <code>running</code> boolean to true and call <code>updatePos</code>.</p>
<pre><code class="language-swift">func startPositioning(_ arg: String?) {
    running = true
    updatePosition()
}
</code></pre>
<p>Implement the <code>stopPositioning</code> method. We set the <code>running</code> boolean to false.</p>
<pre><code class="language-swift">func stopPositioning(_ arg: String?) {
    running = false
}
</code></pre>
<p>Implement the <code>startPositioningAfter</code> method. This is just a convenience method that should support a delayed start.</p>
<pre><code class="language-swift">func startPositioning(after millis: Int32, arg: String?) {
    DispatchQueue.main.asyncAfter(deadline: .now() + (0.001 * Double(millis))) {
        self.startPositioning(arg)
    }
}
</code></pre>
<p>Implement the <code>isRunning</code> method. Return the value of <code>running</code>.</p>
<pre><code class="language-swift">func isRunning() -&gt; Bool {
    return running
}
</code></pre>
<p><a href="https://github.com/MapsIndoors/MapsIndoorsIOS/blob/master/Example/DemoSamples/Show%20My%20Location/MyPositionProvider.swift">See the sample in MyPositionProvider.swift</a></p>
<h2>Create a view controller displaying a map that shows the user's &quot;mocked&quot; location</h2>
<p>Create a class <code>ShowMyLocationController</code> that inherits from <code>UIViewController</code>.</p>
<pre><code class="language-swift">class ShowMyLocationController: UIViewController {
</code></pre>
<p>Add a <code>GMSMapView</code> and a <code>MPMapControl</code> to the class</p>
<pre><code class="language-swift">var map: GMSMapView? = nil
var mapControl: MPMapControl? = nil

override func viewDidLoad() {

    super.viewDidLoad()
</code></pre>
<p>Inside <code>viewDidLoad</code>, setup the map so that it shows the demo venue and initialise mapControl</p>
<pre><code class="language-swift">self.map = GMSMapView.init(frame: CGRect.zero)
self.view = self.map
self.map?.camera = .camera(withLatitude: 57.057964, longitude: 9.9504112, zoom: 20)
self.mapControl = MPMapControl.init(map: self.map!)
</code></pre>
<p>Inside <code>viewDidLoad</code>, optionally add a special icon for the user location</p>
<pre><code class="language-swift">let myLocationRule = MPLocationDisplayRule.init(name: &quot;my-location&quot;, andIcon: UIImage.init(named: &quot;MyLocationDirection&quot;), andZoomLevelOn: 0)
myLocationRule?.iconSize = CGSize(width: 30, height: 30)
self.mapControl?.add(myLocationRule!)
</code></pre>
<p>Inside <code>viewDidLoad</code>, finally</p>
<ul>
<li>Tell mapControl to show the users location</li>
<li>Assign your position provider <code>MyPositionProvider</code> to <code>MapsIndoors.positionProvider</code></li>
<li>Start positioning</li>
</ul>
<pre><code class="language-swift">self.mapControl?.showUserPosition(true)
MapsIndoors.positionProvider = MyPositionProvider()
MapsIndoors.positionProvider.startPositioning(nil)
</code></pre>
<p><a href="https://github.com/MapsIndoors/MapsIndoorsIOS/blob/master/Example/DemoSamples/Show%20My%20Location/ShowMyLocationController.swift">See the sample in ShowMyLocationController.swift</a></p>

      </main>
    </section>
  </body>
</html>
