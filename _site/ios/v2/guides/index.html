<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="/assets/style.css">
    <title>Document</title>
  </head>
  <body>
    <section class="container">
      
  <nav>
    <h2>iOS v2</h2>
    
    <ul class="sidebar-nav"><li class="active"><a href="/ios/v2/guides/">Guides</a></li>
<li class="bold"><a href="/ios/v2/tutorials/">Tutorials</a><ul><li><a href="/ios/v2/tutorials/locationdetailslocationdetailscontroller/">Show location details</a></li>
<li><a href="/ios/v2/tutorials/searchmysearchcontroller/">Create a Search Experience with MapsIndoors - Part 1</a></li>
<li><a href="/ios/v2/tutorials/showmylocationmypositionprovider/">Show the Blue Dot with MapsIndoors - Part 1</a></li>
<li><a href="/ios/v2/tutorials/showmylocationshowmylocationcontroller/">Show the Blue Dot with MapsIndoors - Part 2</a></li>
<li><a href="/ios/v2/tutorials/showrouteshowrouteonmapcontroller/">Get Directions and Show the Result on a Map - Part 1</a></li>
<li><a href="/ios/v2/tutorials/showrouteshowroutecontroller/">Get Directions and Show the Result on a Map - Part 2</a></li></ul></li>
<li><a href="/ios/v2/changelog/">Changelog</a></li></ul>
  </nav>


      <main>
        <blockquote>
<p>A <a href="https://www.markdownguide.org/ios/v3">newer version</a> of the MapsIndoors SDK for iOS is available. The legacy version will not receive new features and will only get critical bugfix and security updates.
{: .mi-warning}</p>
</blockquote>
<h2>Searching for Locations and Displaying the Results on a Map</h2>
<p>Use the <code>MPLocationsProvider</code> class to search for content in your MapsIndoors solution.</p>
<p>This example shows how to setup a query for the nearest single best matching location and display the result on the map:</p>
<pre><code class="language-swift">let locations = MPLocationsProvider.init()
let queryObj = MPLocationQuery.init()

queryObj.query = &quot;Toilet&quot;
queryObj.near = MPPoint.init(lat: 57.057964, lon: 9.9504112)
queryObj.max = 1

locations.getLocationsUsing(queryObj) { (locationData, error) in
    if error == nil {
        let location = locationData?.list.first
        self.mapControl?.go(to: location)
    }
}
</code></pre>
<p>This example shows how to setup a query for a group of locations and display the result on the map:</p>
<pre><code class="language-swift">let locations = MPLocationsProvider.init()
let queryObj = MPLocationQuery.init()

queryObj.categories = [&quot;Toilet&quot;]
queryObj.max = 50

locations.getLocationsUsing(queryObj) { (locationData, error) in
    if error == nil {
        self.mapControl?.searchResult = locationData!.list
        let firstLocation = locationData?.list.first
        self.mapControl?.currentFloor = firstLocation.floor
    }
}
</code></pre>
<p>Please note that you are not guaranteed that the visible floor contains any search results, so that is why we change floor in the above example.</p>
<h2>Getting Directions and Displaying a Route Result on a Map</h2>
<p>Use the <code>MPDirectionsService</code> class to search for directions. You need to build a query using the <code>MPDirectionsQuery</code> class.</p>
<p>This example shows how to setup a query for a route and display the result on the map:</p>
<pre><code class="language-swift">let directions = MPDirectionsService.init()
let renderer = MPDirectionsRenderer.init()
renderer.delegate = self

let origin = MPPoint.init(lat: 57.057917, lon: 9.950361, zValue:0)
let destination = MPPoint.init(lat: 57.058038, lon: 9.950509, zValue:0)

let directionsQuery = MPDirectionsQuery.init(originPoint: origin!, destination: destination!)

directions.routing(with: directionsQuery) { (route, error) in
    renderer.map = self.map
    renderer.route = route
    renderer.routeLegIndex = 0
    renderer.animate(5)
}
</code></pre>
<p>The route object is seperated into objects of <code>MPRouteLeg</code> and these legs are again seperated indo objects of <code>MPRouteStep</code>. A specific part of the route can be rendered by setting the <code>routeLegIndex</code> and/or <code>routeStepIndex</code> properties.</p>
<pre><code class="language-swift">let renderer = MPDirectionsRenderer.init()
renderer.routeLegIndex = 0
renderer.routeStepIndex = 1
</code></pre>
<p>The length of the <code>legs</code> and <code>steps</code> arrays determines the possible values of <code>routeLegIndex</code> and <code>routeStepIndex</code> (<code>0 ..&lt; length</code>).</p>
<h3>Subscribing to Floor Changes in the Rendering</h3>
<p>Assigning a <code>MPDirectionsRenderer</code> delegate will make it possible to know which floor the currently rendered part of the route belongs to:</p>
<pre><code class="language-swift">func floorDidChange(_ floor: NSNumber!) {
    mapControl?.currentFloor = floor
}
</code></pre>
<h3>Working with Directions Settings</h3>
<p>Avoid certain <strong>way types</strong> on the route using the <code>avoidWayTypes</code> property.</p>
<pre><code class="language-swift">let directionsQuery = MPDirectionsQuery.init(originPoint: origin!, destination: destination!)
directionsQuery.avoidWayTypes = [&quot;stairs&quot;]
</code></pre>
<p>Set a <strong>departure date</strong> or an <strong>arrival date</strong> on the route using the <code>departure</code> or <code>arrival</code> property. It will only make sense to set one of these properties at a time.</p>
<pre><code class="language-swift">let directionsQuery = MPDirectionsQuery.init(originPoint: origin!, destination: destination!)
directionsQuery.departure = Date.init()
</code></pre>
<h2>Working with Events</h2>
<p>The MapControl delegate can inform you when the various data from the MapsIndoors services are loaded through it's <code>MPMapControlDelegate</code> so you should set the delegate, in most of the cases with the current UIViewController:</p>
<pre><code class="language-swift">myMapControl.delegate = self
</code></pre>
<p>Implement the <code>onMapDataReady</code> method :</p>
<pre><code class="language-swift">class ViewController: UIViewController, MPMapControlDelegate
</code></pre>
<p>Then implementing the methods below :</p>
<pre><code class="language-swift">func onMapDataReady(){

}
</code></pre>
<h3>Handling marker selections and other user events</h3>
<p>Detecting the user tapping a marker or an infowindow is part of the Google Maps SDK for iOS. Assign <code>myGMSMapView.delegate</code> and implementing the methods: <code>mapView.didTapMarker(marker: GMSMarker)</code> and <code>mapView.didTapInfoWindowOfMarker(marker: GMSMarker)</code></p>
<pre><code class="language-swift">func mapView(_ mapView: GMSMapView, didTap marker: GMSMarker) -&gt; Bool {
    let location = mapControl?.getLocation(marker)
    if location != nil {
        myTextLabel.text = location!.name
    }
    return false
}

func mapView(_ mapView: GMSMapView, didTapInfoWindowOf marker: GMSMarker) -&gt; Bool {
    let location = mapControl?.getLocation(marker)
    if location != nil {
        myTextLabel.text = location!.name
    }
    return false
}
</code></pre>
<h3>Getting a marker from a location and vice versa</h3>
<p>If a <code>MPLocation</code> has been displayed on a map, the marker can be retrieved using <code>location.marker</code>. On the opposite, get a <code>MPLocation</code> from a <code>GMSMarker</code> using <code>getLocation(marker: GMSMarker)</code> on <code>MPMapControl</code>:</p>
<pre><code class="language-swift">myMapControl.getLocation(marker : GMSMarker!)
</code></pre>
<h2>Using Display Rules</h2>
<p>In the <a href="https://cms.mapsindoors.com/types">MapsIndoors CMS</a> you can set display settings for the different types of locations in your MapsIndoors content.</p>
<p>In some cases, you may also want to programmatically set display rules that defines when and how to show a location.</p>
<p>To add display rules, you need to know the types in your location dataset, so look these up in the CMS. The display rule name corresponds to the location type we want the rule to apply for.</p>
<pre><code class="language-swift">// Adding a rule with name nil, will apply generally to all type of locations
myMapControl.add(MPLocationDisplayRule(name: nil, andIcon: UIImage(named : &quot;info&quot;), andZoomLevelOn: 17))

// Adding a rule with a name, will override a more general rule
myMapControl.add(MPLocationDisplayRule(name: &quot;info&quot;, andIcon: UIImage(named : &quot;info&quot;), andZoomLevelOn: 17))
myMapControl.add(MPLocationDisplayRule(name: &quot;parking&quot;, andIcon: UIImage(named : &quot;parking&quot;), andZoomLevelOn: 17))
myMapControl.add(MPLocationDisplayRule(name: &quot;staircase&quot;, andIcon: UIImage(named : &quot;staircase&quot;), andZoomLevelOn: 18))
</code></pre>
<h2>Create Custom UI</h2>
<p>You can create your own UI based on the MapsIndoors data models given from <code>MPDirectionsService</code> or <code>MPLocationsProvider</code>. E.g. build a list of instructions based on the <code>MPRouteLeg</code> and <code>MPRouteStep</code> models given from a <code>MPRoute</code> object. Or build a content page based on the properties on an <code>MPLocation</code> object. You can see an example of this in the <code>DetailsViewController</code> and <code>DirectionsController</code> classes in the app code that is <a href="https://github.com/MapsIndoors/MapsIndoorsIOS/tree/master/Example">distributed along with the MapsIndoors SDK</a>.</p>

      </main>
    </section>
  </body>
</html>
